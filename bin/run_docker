#!/usr/bin/bash

GIGAHORSE_ROOT="$(dirname "$(dirname "$(readlink -fm "$0")")")"

mkdir -p ${GIGAHORSE_ROOT}/.temp

docker run \
    -v ${HOME}:${HOME} \
    --mount type=bind,source=${GIGAHORSE_ROOT}/logic,target=/opt/gigahorse/gigahorse-toolchain/logic \
    --mount type=bind,source=${GIGAHORSE_ROOT}/clientlib,target=/opt/gigahorse/gigahorse-toolchain/clientlib \
    --mount type=bind,source=${GIGAHORSE_ROOT}/.temp,target=/opt/gigahorse/gigahorse-toolchain/.temp \
    --mount type=bind,source=${GIGAHORSE_ROOT}/cache,target=/opt/gigahorse/gigahorse-toolchain/cache \
    --mount type=bind,source=${GIGAHORSE_ROOT}/EventSignature.facts,target=/opt/gigahorse/gigahorse-toolchain/EventSignature.facts,readonly \
    --mount type=bind,source=${GIGAHORSE_ROOT}/PublicFunctionSignature.facts,target=/opt/gigahorse/gigahorse-toolchain/PublicFunctionSignature.facts,readonly \
    -u `id -u $USER`:`id -g $USER` \
    -w $(pwd) \
    -it gigahorse $@
